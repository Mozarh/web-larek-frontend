# **Проектная работа "Веб-ларек"**

Интернет-магазин для веб-разработчиков, где можно просматривать каталог товаров, добавлять их в корзину и оформлять заказы. Приложение построено с использованием современного стека и принципа разделения обязанностей.

## **Используемый стек:**

* HTML — структура страниц.
* SCSS - стилизация интерфейса.
* TS - основная логика приложения.
* Webpack - сборка и компиляция проекта.

## **Структура проекта:**
* src/ — исходные файлы проекта
* src/components/ — папка с JS компонентами
* src/components/base/ — папка с базовым кодом
* src/types/ — типы для TypeScript.
* src/scss/ — стили для всего проекта.

### **Важные файлы:**
* src/pages/index.html — HTML-файл главной страницы
* src/types/index.ts — файл с типами
* src/index.ts — точка входа приложения
* src/scss/styles.scss — корневой файл стилей
* src/utils/constants.ts — файл с константами
* src/utils/utils.ts — файл с утилитами

## **Установка и запуск**
Клонировать репозиторий

```
git clone https://github.com/Mozarh/web-larek-frontend.git
```

После клонирования проекта установить зависимости:

```
npm install 
```

Для запуска проекта в режиме разработки выполнить команду:

```
​npm run start 
```

Для сборки проекта в продакшен выполнить команду: 

```
​npm run build
```

## **Архитектура проекта**

![<Блок-схема>](src/images/block.png)

Проект использует принцип MVC и компоненты с разделением обязанностей.
Основные части архитектуры:
* Модели (Models) — отвечают за бизнес-логику и и хранение данных (например, товары, корзина, заказ).
* Представления (Views) — отображают данные на экране и взаимодействуют с пользователем.
* Контроллеры (Controllers) — управляют логикой между моделями и представлениями.

## **Базовый код**

1. Класс Api - Этот класс управляет HTTP-запросами к серверу, выполняя запросы типа GET и POST. Он необходим для получения данных о товарах и отправки данных о заказах.

*Конструктор:*
```
constructor(baseUrl: string, options: RequestInit = {})
```
* baseUrl: string  - базовый URL для всех запросов к серверу.
* options: RequestInit = {} - глобальные опции для запросов.

*Методы:*
* handleResponse(response: Response): Promise<object>: обработчик ответа сервера. Преобразует ответ в объект JSON.
* get(uri: string) -  выполняет GET-запрос на сервер, передавая uri. Возвращает данные в формате JSON.
* post(uri: string, data: object, method: ApiPostMethods = 'POST') - выполняет POST-запрос, отправляя данные на сервер.

2. Класс EventEmitter- обеспечивает работу событий, позволяя компонентам системы взаимодействовать. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

*Конструктор:*
```
constructor()
```

*Методы:*
* on(event: string, callback: Function)- Установить обработчик на событие.
* off(event: string, callback: Function) — Снимает обработчик с указанного события.
* emit(event: string, data?: any) — Инициирует событие и передаёт данные в обработчик.
* onAll(callback: Function) — Слушает все события и вызывает указанный коллбек для каждого из них.
* offAll() — Убирает все обработчики событий.
* trigger(callback: Function) — Генерирует событие с переданным коллбеком.

3. Component - Базовый класс для всех представлений, реализующий логику работы с DOM. Управляет изменениями классов, установкой текстов и атрибутов, а также добавлением обработчиков событий.

*Конструктор:*
```
constructor(selector: string)
```
*Методы:*
* toggleClass(className: string, add: boolean): void - Добавляет или удаляет класс у элемента.
* setText(content: string): void - Устанавливает текстовое содержимое элемента.
* setAttribute(name: string, value: string): void - Устанавливает атрибут элемента.
* addEventListener(event: string, callback: EventListener): void - Добавляет обработчик события для элемента.
* removeEventListener(event: string, callback: EventListener): void - Удаляет обработчик события.
* hide(): void - Скрывает элемент, устанавливая его стиль display в none. 
* show(): void - Показывает элемент, устанавливая его стиль display в block.

4. ApiProduct - наследуется от класса Api и управляет запросами, связанными с товарами. С помощью этого класса осуществляется взаимодействие с сервером для получения списка товаров и оформления заказов.

*Конструктор:*
Наследует от Api, не требует дополнительных параметров.

*Методы:*
* getListProductCard(): Promise<Product[]> - Получает список товаров с сервера. Возвращает массив объектов Product.
* postOrder(order: Order): Promise<Response> - Отправляет данные о заказе на сервер. Возвращает статус ответа от сервера.

5. Классы для представлений и отображения (например, CatalogItem, Basket, Order, Page) - каждый из этих классов отвечает за отдельную часть интерфейса, управляет визуализацией данных и событиями. Например, CatalogItem отображает товар, Basket — корзину, а Order — процесс оформления заказа.

**Предназначение:**  
Каждый из этих классов отвечает за отдельную часть интерфейса, управляет визуализацией данных и событиями. Например, `CatalogItem` отображает товар, `Basket` — корзину, а `Order` — процесс оформления заказа.

**Пример класса `CatalogItem`:**
- Отображает информацию о товаре (название, изображение, цену).
- Взаимодействует с пользователем, например, при добавлении товара в корзину.

## **Описание компонентов, их функций и связей с другими компонентами**

### **Основные компоненты:**

1. **`AppState`**
   - Управляет состоянием приложения, хранит данные о товарах в каталоге, корзине и заказах.
   - Предоставляет методы для добавления/удаления товаров из корзины, вычисления общей стоимости и других операций с данными.

2. **`Page`**
   - Основной контейнер для отображения страницы.
   - Отвечает за отображение различных частей интерфейса: каталога товаров, корзины, заказа и модальных окон.

3. **`Modal`**
   - Отображает модальные окна, например, для подтверждения действия или вывода информации (например, успешное оформление заказа).

4. **`CatalogItem`**
   - Отображает отдельный товар в каталоге.
   - Слушает события (например, "Добавить в корзину") и взаимодействует с `AppState` для добавления товара в корзину.

5. **`Basket`**
   - Отображает корзину покупок.
   - Слушает события "Удалить из корзины" и обновляет состояние корзины.

6. **`Order`**
   - Отображает форму для оформления заказа.
   - Управляет процессом ввода данных пользователем, таких как адрес и способ оплаты.

7. **`Success`**
   - Отображает информацию о успешном оформлении заказа после его отправки.

### **Взаимодействие компонентов через события**

- Компоненты взаимодействуют через события, которые генерируются с помощью `EventEmitter`.
- Например:
  - При добавлении товара в корзину компонент `CatalogItem` генерирует событие `card:addToBasket`, которое обрабатывается `AppState`, который обновляет данные о корзине.
  - Когда пользователь оформляет заказ, компонент `Order` генерирует событие `order:submit`, которое инициирует процесс отправки заказа через `ApiProduct` и генерирует событие `order:success`, которое отображает сообщение об успешной покупке через компонент `Success`.

### **Пример описания процесса в приложении:**

1. **Просмотр товаров:**
   - Когда приложение загружается, `AppState` получает список товаров через API, и компонент `Page` отображает их в виде карточек с помощью `CatalogItem`.

2. **Добавление товара в корзину:**
   - При клике на товар генерируется событие `card:addToBasket`, которое добавляет товар в корзину через `AppState`.

3. **Оформление заказа:**
   - Когда пользователь нажимает на кнопку "Оформить заказ", отображается модальное окно с компонентом `Order`, в котором можно ввести данные для доставки.
   - После отправки данных заказ подтверждается через `ApiProduct` и генерируется событие `order:success`, которое отображает информацию о успешной покупке через компонент `Success`.

### **Типы данных, используемые в приложении**

- **`IProduct`** — тип, представляющий товар (содержит поля: `id`, `title`, `price`, `description`, `image`).
- **`IOrder`** — тип, представляющий заказ (содержит поля: `items`, `total`, `address`, `email`, `phone`).
- **`FormErrors`** — тип для ошибок формы (содержит ошибочные сообщения для полей формы заказа).

## **Процесс работы приложения**

1. **Модели данных (Models):**
   - **`AppState`** — управляет данными о товарах, корзине и заказах.
   - **`ApiProduct`** — взаимодействует с сервером для получения товаров и отправки заказов.

2. **Представления (Views):**
   - Компоненты типа `Page`, `CatalogItem`, `Basket`, `Modal`, `Order` и другие, которые отображают данные на странице и взаимодействуют с пользователем.

3. **Контроллеры:**
   - Взаимодействие компонентов происходит через события, генерируемые с помощью класса `EventEmitter`, который управляет бизнес-логикой между компонентами.